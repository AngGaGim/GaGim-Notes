## 数据库问答系统设计与优化笔记

**日期:** 2024年4月10日

### 1. 文件解析模块

**主要功能:** 针对Excel文件进行结构化解析。

**当前支持的布局类型:**
*   **单表模式:** 支持多层级横向表头与数据内容的解析。
    *   **示例结构:**
        ```
        | age | _      | salary |
        | --- |--------|--------|
        | age | name   | _      |
        | 18  | meme   | 199    |
        ```

**存储逻辑:**
*   **存储目的地:** SQLite 数据库。
*   **数据模型:** 每个Excel文件的单个 `sheet`（工作表）被视为数据库中的一张独立表。
*   **存储内容:** 针对每个解析出的表，存储以下元数据：
    *   **表名:** 由文件名拼音缩写 + 工作表名拼音缩写组合生成。
    *   **表描述:** 对该表内容的概括性描述。
    *   **表头字段名:** 对应Excel中的列名。
    *   **字段类型:** 推断的字段数据类型。
    *   **字段描述:** 对每个字段含义的详细描述。

**当前不足与改进点:**
*   **缺乏文件级别摘要:** 目前的存储方式仅将多个文件中的工作表打平为多张表，未存储文件本身的描述信息。这导致在召回阶段，无法有效利用文件层面的摘要信息进行初步筛选，从而限制了对数据理解的深度。
*   **建议:** 考虑增加文件级别的描述字段，以便在召回时能先基于文件内容进行粗粒度筛选，再深入到具体的表。

---

### 2. 召回机制模块

**核心机制:**
*   **策略:** 采用 ReAct（Reasoning and Acting）形式。
*   **依据:** 基于系统提供的表Schema（表名、字段名、表描述、字段描述），模型选择与用户查询相关的表。

**当前不足与问题:**
*   **语义理解能力欠缺:** 模型在理解字段的深层语义方面存在不足。
    *   **具体案例:** 在近期针对政务场景的问答测试中，尽管我们为每张表和字段提供了详细描述，模型仍然难以准确理解这些字段在特定政务领域中的专业含义，导致选择的查询表不够完善或不准确。

**解决方案（短期与长期）:**

*   **短期解决方案:**
    *   **人工修整:** 在模型输出不准确时，进行人工干预和修正，以确保查询结果的正确性。

*   **长期优化方向（待探讨）:**
    *   **增强领域知识注入:**
        *   引入领域知识图谱（Knowledge Graph）或专业术语表（Glossary），以结构化的方式向模型提供更丰富的领域知识。
        *   针对特定领域（如政务）构建或微调模型，使其更好地理解专业词汇和业务逻辑。
    *   **优化语义Embedding:** 提升字段描述和用户查询文本的Embedding质量，增强语义匹配的准确性。
    *   **改进上下文理解:** 让模型在理解查询时，能更好地结合历史对话和整体业务背景。
