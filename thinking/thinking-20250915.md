
[[2025-10-28 16:29]]


整理结构化、半结构化表头提取、解析方案


## 已有技术路线


| 技术路线      | 缺点                | 产品       |
| --------- | ----------------- | -------- |
| NL2SQL    | 先转换成结构化表，但部分数据会丢失 |          |
| NL2Pandas | 先转换成结构化表          | pandasai |



## 数据类型

| 布局              | 图示                                                                                                           |
| --------------- | ------------------------------------------------------------------------------------------------------------ |
| 1. 常规单表头        | ![[Pasted image 20251028163655.png]]                                                                         |
| 1.2 常规单表头-数据带合并 | ![[Pasted image 20251028164139.png]]![[Pasted image 20251028165241.png]]                                     |
| 2. 1 合并横向表头     | ![[Pasted image 20251028163626.png]]![[Pasted image 20251028163948.png]]![[Pasted image 20251028165140.png]] |
| 2.2 合并横向表头-带说明  | ![[Pasted image 20251028164614.png]]![[Pasted image 20251028164702.png]]                                     |
| 3. 纵向多表         | ![[4e139270-9a88-45b1-af77-b142ac4dec8b.png]]![[Pasted image 20251028170555.png]]                            |
| 4. 横向多表         | ![[Pasted image 20251028164359.png]]![[Pasted image 20251028164445.png]]                                     |
| 5. 无规范表头        | ![[Pasted image 20251028170315.png]]                                                                         |
| 6. 其他制式 - 合同    | ![[Pasted image 20251028170859.png]]![[Pasted image 20251028170923.png]]![[Pasted image 20251028170935.png]] |





存储：
csv
sql
json
duckDB

## 方案

1. 基于当前方案识别表头索引行，进一步提取
2. excel 通过libreoffice（外挂服务） 转换成html， 再转换成pdf，使用minerU(需要测评上述数据所有情况，极端情况：数据量特别大的情况)【问题： minerU存储markdown，转换markdown后如何用于问答？应该走什么方式？】

3. st-raptor(存储为树形结构) 解析速度比较慢，且不稳定，多种excel存在解析失败的问题(未定位问题是否模型导致)

提取表头：
1. 转换为pdf，获取pdf第一页，vlm提取表头信息，存储到sql (表头说明表)【❌会出现幻觉，且结构化依赖模型能力】
2. 模型获取行索引，将行索引前的所有文本输入到模型中结构话提取，存储到sql (表头说明表)
3. st-raptor: 如果数据量特别大，是否会影响性能？ 【解析效果会有影响、表格不规范会出现解析失败】
4. st-raptor： 用于提取表头


## 评测：

### 用例一： Eco

原始数据
![[Pasted image 20251029161322.png]]

a：仅截取表头以上
![[Pasted image 20251029161352.png]]

b：截取表头+局部数据
![[Pasted image 20251029163231.png]]


ST-Raptor


a:
![[48653675-2929-4eb0-9b6a-3382e89493fe.png]]
```
 {'table': {'subtable1': {'None': 'SYMBOL:', '■ ENGINEERING ／ □ PROTOTYPE CHANGE ORDER ': 'D', 'None1': '= CHANGE', 'None2: '= ADD', 'None3': 'D', 'None4': '= DELETE', 'Model Name:': 'None', 'JFS-15 ': 'None', 'None5': 'Dispositon: C = Cancel, K = Keep, R = Rework, RS = Re-sell, \nRTV = Return To Vendor, SB = Substitution, SC = Scrap', 'E/PCO No:': 'None'}, 'NO': 'ASSY PART NO.', 'A': ''}}
```

b:
![[Pasted image 20251029163410.png]]



minerU 线上

只有原始数据这张表解析结果是正确的
![[Pasted image 20251029161659.png]]
![[Pasted image 20251029161711.png]]
![[Pasted image 20251029163439.png]]
![[Pasted image 20251029162421.png]]


markitdown 
```
## Sheet1
| Unnamed: 0 | Unnamed: 1 | Unnamed: 2 | Unnamed: 3 | Unnamed: 4 | Unnamed: 5 | Unnamed: 6 | Unnamed: 7 | Unnamed: 8 | Unnamed: 9 | Unnamed: 10 | Unnamed: 11 | Unnamed: 12 | Unnamed: 13 | Unnamed: 14 | Unnamed: 15 | Unnamed: 16 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 中东-阿联酋空运-带电 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 以下价格RMB报价，已含燃油！！交货单上麻烦备注渠道代码 ！ | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 渠道代码 | 渠道 | 产品分类 | 区域 | 21kg+ | NaN | 51kg+ | 71kg+ | 101kg+ | NaN | 301kg+ | NaN | 501kg+ | NaN | 参考时效\n（工作日） | 渠道特点 | 备注 |
| AEKY-PH | 中东阿联酋空运带电 | 含电含磁配套电池产品等 | 迪拜/FBA | 44 | NaN | 39 | 39 | 37 | NaN | 37 | NaN | 37 | NaN | 5-7 | 香港飞 | 木架木箱包装需要打活页/单件100KG以上打卡板/单件限重500KG,单件尺寸限制160CM\*140CM\*150CM |
| NaN | NaN | NaN | 其他城市 | 46 | NaN | 41 | 41 | 39 | NaN | 39 | NaN | 39 | NaN | 6-8 | NaN | NaN |
| 报关方式 | 阿联酋空运带电：接受一般贸易报关，350RMB/份报关费.续页50RMB/页。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 中东-阿联酋空运-普货 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 渠道代码 | 渠道 | 产品分类 | 区域 | 21kg+ | NaN | 51kg+ | 71kg+ | 101kg+ | NaN | 301kg+ | NaN | 501kg+ | NaN | 参考时效\n（工作日） | 渠道特点 | 备注 |
| AEKY-DD | 中东阿联酋空运普货 | 无电无磁无牌普货 \n | 迪拜/FBA | 41 | NaN | 35 | 35 | 32 | NaN | 32 | NaN | 32 | NaN | 5-7 | 大陆飞 | 中性纸箱包装，不接木箱，托盘货 |
| NaN | NaN | NaN | 其他城市 | 43 | NaN | 37 | 37 | 34 | NaN | 34 | NaN | 34 | NaN | 6-8 | NaN | NaN |
| 报关方式 | 阿联酋空运普货：报关件需单票301kg以上 且不能超5个品名，纸箱包装，不接木箱，托盘货 ，\n接受一般贸易报关，350RMB/份报关费.续页50RMB/页。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 中东阿联酋空运-特货 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 渠道代码 | 渠道 | 产品分类 | 区域 | 21kg+ | NaN | 51kg+ | 71kg+ | 101kg+ | NaN | 301kg+ | NaN | 501kg+ | NaN | 参考时效\n（工作日） | 渠道特点 | 备注 |
| AEKY-YL | 中东阿联酋空运YL线 | A类、CCTV、医疗用品 | 迪拜/FBA | 50 | NaN | 45 | 45 | 43 | NaN | 43 | NaN | 43 | NaN | 6-8 | 香港飞 | 纸箱包装，木架木箱需要打活页。 |
| NaN | NaN | NaN | 其他城市 | 52 | NaN | 47 | 47 | 45 | NaN | 45 | NaN | 45 | NaN | 8-10 | NaN | NaN |
| AEKY-DG | 中东阿联酋空运DG线 | 移动电源、纯电池 ，化妆品，食品， | 迪拜/FBA | 57 | NaN | 52 | 52 | 50 | NaN | 50 | NaN | 50 | NaN | 6-8 | 香港飞 | 纸箱包装，单个产品绝缘包装，木架木箱需要打活页 |
| NaN | NaN | NaN | 其他城市 | 59 | NaN | 54 | 54 | 52 | NaN | 52 | NaN | 52 | NaN | 8-10 | NaN | NaN |
| 报关方式 | 接受一般贸易报关，以上价格加350RMB/份报关费.续页50RMB/页(如报关资料跟货物不符，瞒报漏报虚报等，产生所有问题责任由客户自己承担。）\n特货必须进出口等认证资料齐全。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 发货须知 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 1.交货前请与我司业务联系开户，两份商业发票/箱单（申报品名按照实际货物申报，如因瞒报漏报造成清关延误我司概不负责） 货时间为09:00-20:00（周六收货延迟一天发货） 5.遗失索赔：保丢不保损（易碎产品打木架），赔偿运费3倍（含运费）。 6.支持运费到付。如果收货人拒付，则要发货人承担费用，否则按照扣货处理，收到运费后，两周后安排退款，到付手续费收运费3%。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 2.重量提示：21KG以上不足1KG按照1KG计费。海派最低1CBM计费，超过0.5CBM按照1进位，保留小数点后1位计算。体积/6000和实重取大计费重。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 3.不接受产品：粉末、赌博游戏机、军火武器、易燃易爆品等，一经发现冲货行为，我司将追究相应责任! | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 4.遗失索赔：保丢不保损，适用于整件货被丢，单件里面的pcs丢失不在我司赔偿范围（易碎产品需谨慎），我司理赔限额为《已付运费：退回运费并赔偿2倍运费（不包含派送费用）\n最高不超货值。 因不可抗力原因造成的货物损失不在索赔范围内（包含海关航空原因），赔偿受理截止时间：委托方收到货后3个工作日内必须提出申请，超过3个工作日不再受理。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 5.支持运费到付。如果收货人拒付，则要发货人承担费用，否则按照扣货处理，收到运费后，两周后安排退款，到付手续费收运费3%。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 7.派送服务：只派送一次，二次派送费实报实销，不送货上楼，木箱木架等超大件只派送到收货人门口，收货人安排叉车卸货。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 8.包装方式：纸箱或木箱包装牢固，保证防震防摔，木架木箱需要免熏蒸材料打活页，方便查货，底座卡脚不低于8cm，木箱高度不150CM，单件100KG以上打卡板/单件限重\n500KG,单件尺寸限制160CM\*140CM\*150CM，超尺寸单独确认， | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| A类：服装、鞋帽、纺织、皮革、面料 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 派送区域 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 1.阿联酋其他地区包括：Shar jah（沙迦）/Abu dhabi（阿布扎比）Al Ain（阿莱茵）/Ajman（阿基曼）/Ras Al Khaimah（拉斯海马/哈伊马角）/Umm Alquain（乌姆盖万） | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 2.阿联酋其他区域加收偏远附加费,大货单独派送实报实销。 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 3.保税区（Free Zone），派船 ，展会等其他偏远地区派送需单独确认，实报实销 | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |
| 温馨提示：贵司一旦交货，我司则视已阅读并默认以上所有内容! | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN | NaN |

```

minerU 私有部署
```
<table><tr><td colspan=\"2\">TES</td><td colspan=\"4\">■ENGINEERING/□PROTOTYPE CHANGE ORDER</td><td colspan=\"2\">Model Name:</td><td colspan=\"9\">JFS-15</td></tr><tr><td colspan=\"2\" rowspan=\"2\">SYMBOL: A</td><td rowspan=\"2\">CHANGE</td><td colspan=\"2\"></td><td rowspan=\"2\">=</td><td colspan=\"2\"></td><td colspan=\"9\">Dispositon: C = Cancel, K = Keep, R = Rework, RS = Re-sell, RTV = Return To Vendor, SB = Substitution,</td></tr><tr><td>A</td><td>ADD</td><td>DELETE</td><td>DESCRIPTION /</td><td></td><td>SC = Scrap Unit</td><td>Status</td><td>Vendor</td><td>Open</td><td>In</td><td>Stock</td><td>WIP</td><td>Finish</td><td>F/G</td></tr><tr><td>NO</td><td colspan=\"2\">ASSY PART NO.</td><td>SY</td><td>ID Loc.</td><td>PART NO.</td><td>SPECIFICATION</td><td>Q&#x27;TYOR</td><td>Cost</td><td></td><td>Stock</td><td></td><td>PO</td><td>Route</td><td></td><td></td><td>Goods</td><td>In Route</td></tr></table>
```

![[Pasted image 20251029161551.png]]



## note

st-raptor:

http://192.168.30.69:7860/
192.168.30.69
root 密码：T9k!qW@7rF$3xYp&
/data/projects/ST-Raptor
tail -n 1000 -f excel.log

minerU:
http://10.8.0.77:18000/docs

